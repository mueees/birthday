var Conversion = C = {};


Conversion.getField = function(tweet){
    var r = {};
    r.user = {};

    r.coordinates = tweet.coordinates;
    r.entities = tweet.entities;
    r.created_at = tweet.created_at;
    r.favorite_count = tweet.favorite_count;
    r.id_str = tweet.id_str;
    r.retweet_count = tweet.retweet_count;
    r.text = tweet.text;
    r.user.profile_image_url = tweet.user.profile_image_url;
    r.user.screen_name = tweet.user.screen_name;
    r.user.name = tweet.user.name;
    r.user.followers_count = tweet.user.followers_count;

    return r;
}

//Заменяем сжатые ссылки на нормальные
Conversion.replaceLink = function(tweet){

    if( tweet.entities.urls && tweet.entities.urls.length > 0 ){

        var urls = tweet.entities.urls;

        for(var i=0; i < urls.length; i++ ){
            tweet.text = tweet.text.replace(urls[i].url, "<a target='_blank' href='"+urls[i].expanded_url+"'>"+urls[i].expanded_url+"</a>");
        }
    }

    return tweet;
}

//Заменяем аватар на самый большйо по размеру
Conversion.replaceImg = function(tweet){
    var image = tweet.user.profile_image_url;
    var pos = image.lastIndexOf('_');
    tweet.user.profile_image_url = image.substring(0, pos) + "_bigger" + image.substring(pos + 7);
    return tweet;
}

module.exports = function(tweet){
    var t = C.getField(tweet);
    t = C.replaceLink(t);
    t = C.replaceImg(t);
    return t;
};